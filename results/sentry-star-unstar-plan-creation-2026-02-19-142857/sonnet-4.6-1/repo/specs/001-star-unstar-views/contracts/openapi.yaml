openapi: '3.1.0'
info:
  title: Sentry – Star/Unstar Issue Views API
  version: '1.0.0'
  description: |
    Endpoints for starring and unstarring shared GroupSearchViews.
    All paths are relative to the Sentry API base: /api/0/

servers:
  - url: /api/0

paths:
  /organizations/{organization_id_or_slug}/group-search-views/{view_id}/star/:
    parameters:
      - name: organization_id_or_slug
        in: path
        required: true
        schema:
          type: string
        description: Organization slug or numeric ID.
      - name: view_id
        in: path
        required: true
        schema:
          type: string
        description: Numeric ID of the GroupSearchView to star or unstar.

    put:
      operationId: starGroupSearchView
      summary: Star a view
      description: |
        Adds the specified GroupSearchView to the calling user's starred views list.

        - Idempotent: starring an already-starred view returns the existing record unchanged.
        - If `position` is omitted, the view is appended to the end of the list.
        - If `position` is provided, all existing entries at that position and later shift up by 1.
        - The view must belong to the organization and be either owned by the user or have
          `visibility == "organization"`.

        Requires feature flag: `organizations:issue-view-sharing`.
      tags: [Views]
      security:
        - auth_token: [member:read, member:write]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StarViewRequest'
            examples:
              AppendToEnd:
                summary: Star without specifying position (appends to end)
                value: {}
              AtPosition:
                summary: Star at a specific position
                value:
                  position: 2
      responses:
        '200':
          description: View starred successfully (or was already starred — idempotent).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StarredView'
              example:
                id: '12345'
                name: 'High Priority Issues'
                query: 'is:unresolved issue.priority:[high, medium]'
                querySort: 'date'
                projects: [1, 2]
                isAllProjects: false
                environments: ['production']
                timeFilters:
                  period: '14d'
                lastVisited: '2026-02-19T10:30:00.000Z'
                dateCreated: '2026-01-15T08:00:00.000Z'
                dateUpdated: '2026-02-10T12:00:00.000Z'
                position: 0
        '404':
          description: View not found, not accessible to the user, or feature flag disabled.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: Invalid request (e.g., position is negative).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      operationId: unstarGroupSearchView
      summary: Unstar a view
      description: |
        Removes the specified GroupSearchView from the calling user's starred views list.

        - Idempotent: unstarring a view that is not currently starred returns 204 without error.
        - After removal, all views at a higher position shift down by 1.
        - The view must belong to the organization and be either owned by the user or have
          `visibility == "organization"`.

        Requires feature flag: `organizations:issue-view-sharing`.
      tags: [Views]
      security:
        - auth_token: [member:read, member:write]
      responses:
        '204':
          description: View unstarred successfully (or was not starred — idempotent).
        '404':
          description: View not found, not accessible to the user, or feature flag disabled.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    auth_token:
      type: http
      scheme: bearer
      description: Sentry auth token

  schemas:
    StarViewRequest:
      type: object
      properties:
        position:
          type: integer
          minimum: 0
          nullable: true
          description: |
            0-based position at which to insert the view in the user's starred list.
            If omitted or null, the view is appended to the end.
      additionalProperties: false
      example:
        position: 2

    StarredView:
      type: object
      description: A GroupSearchView as it appears in the user's starred list, with position.
      required:
        - id
        - name
        - query
        - querySort
        - projects
        - isAllProjects
        - environments
        - timeFilters
        - lastVisited
        - dateCreated
        - dateUpdated
        - position
      properties:
        id:
          type: string
          description: Numeric ID of the GroupSearchView, returned as string.
          example: '12345'
        name:
          type: string
          description: Display name of the view.
          example: 'High Priority Issues'
        query:
          type: string
          description: Issue stream filter query.
          example: 'is:unresolved issue.priority:[high, medium]'
        querySort:
          type: string
          enum: [date, new, old, priority, freq, user, inbox]
          description: Sort order for the issue stream.
          example: 'date'
        projects:
          type: array
          items:
            type: integer
          description: IDs of projects scoped to this view. Empty array means all projects (if isAllProjects=true).
          example: [1, 2]
        isAllProjects:
          type: boolean
          description: Whether the view applies to all projects in the organization.
          example: false
        environments:
          type: array
          items:
            type: string
          description: Environment names scoped to this view.
          example: ['production']
        timeFilters:
          type: object
          description: Time range filter, e.g. {"period":"14d"} or {"start":"...","end":"..."}.
          example:
            period: '14d'
        lastVisited:
          type: string
          format: date-time
          nullable: true
          description: ISO 8601 timestamp of when this user last visited the view. Null if never visited.
          example: '2026-02-19T10:30:00.000Z'
        dateCreated:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the view was created.
          example: '2026-01-15T08:00:00.000Z'
        dateUpdated:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the view was last updated.
          example: '2026-02-10T12:00:00.000Z'
        position:
          type: integer
          minimum: 0
          description: 0-based position of this view in the user's personal starred list.
          example: 0

    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Human-readable error message.
          example: 'Not found.'
